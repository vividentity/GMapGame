<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.1&amp;sensor=false"></script>
<script type="text/javascript">
  //<![CDATA[
//  var map;
//  var geocoder;
//
//  initialize();
//
//  function initialize() {
//	 geocoder = new google.maps.Geocoder();
//	 
//	 geocoder.geocode({
//		'address': 'NR31 8SX',
//		'partialmatch': true}, geocodeResult);
//  }
//
//  function geocodeResult(results, status) {
//
//	 if (status == 'OK' && results.length > 0) {
//		 
//		var latlng = new google.maps.LatLng(results[0].geometry.location.b,results[0].geometry.location.c);
//		
//		var myOptions = {
//		   zoom: 15,
//		   center: results[0].geometry.location,
//		   disableDefaultUI: true,
//		   mapTypeId: google.maps.MapTypeId.SATELLITE 
//		};
//
//		var person = new google.maps.MarkerImage('mapIcon.png',
//			// size of marker
//			new google.maps.Size(16, 32),
//			// store location is at pin
//			new google.maps.Point(0, 0),
//			// info window anchor
//			new google.maps.Point(0, 0)
//		);
//
//		map = new google.maps.Map(document.getElementById("gmaps-container"), myOptions);
//		
//		var marker = new google.maps.Marker({
//			 position: results[0].geometry.location,
//			 map: map,
//			 icon: person
//		  });

//		var contentString = '<div id="et-gmaps-content">'+
//		'<div id="bodyContent">'+
//		'<p><a target="_blank" href="http://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q='+escape(results[0].formatted_address)+'&amp;ie=UTF8&amp;view=map">'+results[0].formatted_address+'</a>'+
//		'</p>'+
//		'</div>'+
//		'</div>';
//
//		var infowindow = new google.maps.InfoWindow({
//		   content: contentString,
//		   maxWidth: 100
//		});
//
//		google.maps.event.addListener(marker, 'click', function() {
//		   //infowindow.open(map,marker);
//		   alert('hello');
//		});
//
//		google.maps.event.trigger(marker, "click");
//
//
//	 } else {
//		alert("Geocode was not successful for the following reason: " + status);
//	 }
//  }

//<![CDATA[
//
//    if (GBrowserIsCompatible()) {
//
// 
//
//      var map = new GMap2(document.getElementById("map"));
//
//      map.addControl(new GMapTypeControl());
//
//      map.setCenter(new GLatLng(0,0),2);
//
//      var dirn = new GDirections();
//
//      var step = 10; // metres
//
//      var tick = 50; // milliseconds
//
//      var poly;
//
//      var eol;
//
//      var car = new GIcon();
//
//          car.image="caricon.png"
//
//          car.iconSize=new GSize(32,18);
//
//          car.iconAnchor=new GPoint(16,9);
//
//      var marker;
//
//      var k=0;
//
//      var stepnum=0;
//
//      var speed = "";   
//
//
//
//      function animate(d) {
//
//        if (d>eol) {
//
//          document.getElementById("step").innerHTML = "<b>Trip completed</b>";
//
//          document.getElementById("distance").innerHTML =  "Miles: "+(d/1609.344).toFixed(2);
//
//          return;
//
//        }
//
//        var p = poly.GetPointAtDistance(d);
//
//        if (k++>=180/step) {
//
//          map.panTo(p);
//
//          k=0;
//
//        }
//
//        marker.setPoint(p);
//
//        document.getElementById("distance").innerHTML =  "Miles: "+(d/1609.344).toFixed(2)+speed;
//
//        if (stepnum+1 < dirn.getRoute(0).getNumSteps()) {
//
//          if (dirn.getRoute(0).getStep(stepnum).getPolylineIndex() < poly.GetIndexAtDistance(d)) {
//
//            stepnum++;
//
//            var steptext = dirn.getRoute(0).getStep(stepnum).getDescriptionHtml();
//
//            document.getElementById("step").innerHTML = "<b>Next:</b> "+steptext;
//
//            var stepdist = dirn.getRoute(0).getStep(stepnum-1).getDistance().meters;
//
//            var steptime = dirn.getRoute(0).getStep(stepnum-1).getDuration().seconds;
//
//            var stepspeed = ((stepdist/steptime) * 2.24).toFixed(0);
//
//            step = stepspeed/2.5;
//
//            speed = "<br>Current speed: " + stepspeed +" mph";
//
//          }
//
//        } else {
//
//          if (dirn.getRoute(0).getStep(stepnum).getPolylineIndex() < poly.GetIndexAtDistance(d)) {
//
//            document.getElementById("step").innerHTML = "<b>Next: Arrive at your destination</b>";
//
//          }
//
//        }
//
//        setTimeout("animate("+(d+step)+")", tick);
//
//      }
//
//
//
//      GEvent.addListener(dirn,"load", function() {
//
//        document.getElementById("controls").style.display="none";
//
//        poly=dirn.getPolyline();
//
//        eol=poly.Distance();
//
//        map.setCenter(poly.getVertex(0),17);
//
//        map.addOverlay(new GMarker(poly.getVertex(0),G_START_ICON));
//
//        map.addOverlay(new GMarker(poly.getVertex(poly.getVertexCount()-1),G_END_ICON));
//
//        marker = new GMarker(poly.getVertex(0),{icon:car});
//
//        map.addOverlay(marker);
//
//        var steptext = dirn.getRoute(0).getStep(stepnum).getDescriptionHtml();
//
//        document.getElementById("step").innerHTML = steptext;
//
//        setTimeout("animate(0)",2000);  // Allow time for the initial map display
//
//      });
//
//
//
//      GEvent.addListener(dirn,"error", function() {
//
//        alert("Location(s) not recognised. Code: "+dirn.getStatus().code);
//
//      });
//
//
//
//      function start() {
//
//        var startpoint = document.getElementById("startpoint").value;
//
//        var endpoint = document.getElementById("endpoint").value;
//
//        dirn.loadFromWaypoints([startpoint,endpoint],{getPolyline:true,getSteps:true});
//
//      }
//
//
//
//    }
//
//    //]]>
  
var geocoder;
var person;
var location;
var hordes;
var map;
var markersArray = [];
var bounds;
var infowindow =  new google.maps.InfoWindow({
    content: ''
});

//plot initial point using geocode instead of coordinates (works just fine)
function initialize() {
	
    geocoder = new google.maps.Geocoder();
    bounds = new google.maps.LatLngBounds ();

    var myOptions = {
        zoom: 18, 
		minZoom: 18,
		maxZoom: 18,
        mapTypeId: google.maps.MapTypeId.SATELLITE,
		draggable: false,
		//disableDefaultUI: true
    };
	
    map = new google.maps.Map(document.getElementById("gmaps-container"), myOptions);

    geocoder.geocode( { 'address': '53, el alamein way, bradwell, NR31 8SX'}, function(results, status) {
		
        if (status == google.maps.GeocoderStatus.OK) {
			
//			person = new google.maps.MarkerImage('map.png',
//				// size of marker
//				new google.maps.Size(16, 32),
//				// store location is at pin
//				new google.maps.Point(0, 0),
//				// info window anchor
//				new google.maps.Point(0, 0)
//			);
			
            map.setCenter(results[0].geometry.location);

			playermarker = new google.maps.Marker({
				position: results[0].geometry.location,
				map: map,
				icon: 'person.png'
			 });

            bounds.extend(results[0].geometry.location);

            markersArray.push(playermarker);
			
			google.maps.event.addListener(map, 'click', function(event) {
				playermarker.setPosition(event.latLng);
			});
			// Add circle overlay and bind to marker
			var circle = new google.maps.Circle({
			  map: map,
			  radius: 100,    //in metres
			  fillColor: '#AA0000'
			});

			circle.bindTo('center', playermarker, 'position');
        }
        else{
            alert("Geocode was not successful for the following reason: " + status);
        }
		
    });
	
	

    plotMarkers();
	
	plotHords();
}

var locationsArray = [
		['Playing Fields', 'The Playing Fields, Mill Lane, Great Yarmouth NR31 8HS', 'location-23'],
		['Bradwell Fuel Station', 'Blackbird Close, Great Yarmouth, Norfolk NR31 8RU', 'location-34']
	];
var hordeArray = [
		['Small Horde', '54 Blackbird Close, Bradwell, Great Yarmouth, Norfolk NR31 8RU, UK', 'horde-56'],
		['Large Horde', 'Blackbird Close, Bradwell, Great Yarmouth, Norfolk NR31 8RT, UK', 'horde-12'],
		['Small Horde', '141 El Alamein Way, Bradwell, Great Yarmouth, Norfolk NR31 8SX, UK', 'horde-78'],
		['Large Horde', '3 El Alamein Way, Bradwell, Great Yarmouth, Norfolk NR31 8SX, UK', 'horde-92']
	];

function plotMarkers(){
    var i;
    for(i = 0; i < locationsArray.length; i++){
        codeAddresses(locationsArray[i]);
    }
}
function plotHords(){
    var i;
    for(i = 0; i < hordeArray.length; i++){
        codeHordeMovment(hordeArray[i]);
    }
}

function codeAddresses(address){
	
    geocoder.geocode( { 'address': address[1]}, function(results, status) { 
        if (status == google.maps.GeocoderStatus.OK) {
			
            marker = new google.maps.Marker({
                map: map,
				icon: 'location.png',
                position: results[0].geometry.location
            });
			
			marker.set("id", address[2]);

            google.maps.event.addListener(marker, 'click', function() {
//                infowindow.setContent(address[0]);
//                infowindow.open(map, this);

				openScreen( address[2] );
            });

            bounds.extend(results[0].geometry.location);

            markersArray.push(marker); 
        }
        else{
            alert("Geocode was not successful for the following reason: " + status);
        }

        map.fitBounds(bounds);
    });
}

function codeHordeMovment(address){
	
    geocoder.geocode( { 'address': address[1]}, function(results, status) { 
        if (status == google.maps.GeocoderStatus.OK) {
			
            marker = new google.maps.Marker({
                map: map,
				icon: 'horde.png',
                position: results[0].geometry.location
            });
			
			marker.set("id", address[2]);

            google.maps.event.addListener(marker, 'click', function() {
//                infowindow.setContent(address[0]);
//                infowindow.open(map, this);
				
				openScreen( address[2] );
				
            });

            bounds.extend(results[0].geometry.location);

            markersArray.push(marker); 
        }
        else{
            alert("Geocode was not successful for the following reason: " + status);
        }

        map.fitBounds(bounds);
    });
}

google.maps.event.addDomListener(window, 'load', initialize);


  //]]>
  function openScreen( theid ){
  
//	alert( 'Open Dialog and information box for ID: ' + theid );
//	console.log( theid );
	
	$('#dialog-box').fadeIn().html( theid );

  }

</script>

<div id="gmaps-border" style="position:relative;">
	<div id="gmaps-container" style="width:100%; height:100%;"></div>
	<div id="dialog-box" style="display:none; position:absolute; top: 0; left: 0; bottom: 0; right: 0; width:100px; height:100px; background: #fff;border:1px solid;margin: auto;"></div>
</div>